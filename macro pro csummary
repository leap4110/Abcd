%MACRO get_distinct(table=, field=);
   PROC SUMMARY DATA=&table NWAY;
      CLASS &field / ORDER=DATA;
      OUTPUT OUT=distinct_&field(KEEP=&field);
   RUN;
   
   /* Add row number for merging */
   DATA distinct_&field;
      SET distinct_&field;
      _row = _N_;
   RUN;
%MEND;

/* Call macro for each field */
%get_distinct(table=business_table, field=field1);
%get_distinct(table=business_table, field=field2);
%get_distinct(table=business_table, field=field3);

/* Merge all datasets side by side */
DATA consolidated_distinct;
   MERGE distinct_field1(RENAME=(_row=_row1))
         distinct_field2(RENAME=(_row=_row2))
         distinct_field3(RENAME=(_row=_row3));
   BY _row1;
   DROP _row1 _row2 _row3;
RUN;

PROC PRINT DATA=consolidated_distinct;
   TITLE "Consolidated Distinct Values";
RUN;




%MACRO consolidate_distinct(table=, fields=);
   %LOCAL i field field_list merge_list;
   
   /* Step 1: Create distinct datasets for each field */
   %DO i=1 %TO %SYSFUNC(countw(&fields));
      %LET field = %SCAN(&fields, &i);
      
      PROC SUMMARY DATA=&table NWAY;
         CLASS &field / ORDER=DATA;
         OUTPUT OUT=distinct_&field(KEEP=&field);
      RUN;
      
      /* Add row number */
      DATA distinct_&field;
         SET distinct_&field;
         _row = _N_;
      RUN;
   %END;
   
   /* Step 2: Build merge statement */
   %LET merge_list = ;
   %DO i=1 %TO %SYSFUNC(countw(&fields));
      %LET field = %SCAN(&fields, &i);
      %LET merge_list = &merge_list distinct_&field;
   %END;
   
   /* Step 3: Merge all datasets */
   DATA consolidated_distinct;
      MERGE &merge_list;
      BY _row;
      DROP _row;
   RUN;
   
   PROC PRINT DATA=consolidated_distinct;
      TITLE "Consolidated Distinct Values";
   RUN;
%MEND;


%MACRO CONSOLIDATE_DISTINCT(TABLE=, FIELDS=);
   %LOCAL I FIELD FIELD_LIST MERGE_LIST;
   
   /* STEP 1: CREATE DISTINCT DATASETS FOR EACH FIELD */
   %DO I=1 %TO %SYSFUNC(COUNTW(&FIELDS));
      %LET FIELD = %SCAN(&FIELDS, &I);
      
      PROC SUMMARY DATA=&TABLE NWAY;
         CLASS &FIELD / ORDER=DATA;
         OUTPUT OUT=DISTINCT_&FIELD(KEEP=&FIELD);
      RUN;
      
      /* ADD ROW NUMBER */
      DATA DISTINCT_&FIELD;
         SET DISTINCT_&FIELD;
         _ROW = _N_;
      RUN;
   %END;
   
   /* STEP 2: BUILD MERGE STATEMENT */
   %LET MERGE_LIST = ;
   %DO I=1 %TO %SYSFUNC(COUNTW(&FIELDS));
      %LET FIELD = %SCAN(&FIELDS, &I);
      %LET MERGE_LIST = &MERGE_LIST DISTINCT_&FIELD;
   %END;
   
   /* STEP 3: MERGE ALL DATASETS */
   DATA CONSOLIDATED_DISTINCT;
      MERGE &MERGE_LIST;
      BY _ROW;
      DROP _ROW;
   RUN;
   
   PROC PRINT DATA=CONSOLIDATED_DISTINCT;
      TITLE "CONSOLIDATED DISTINCT VALUES";
   RUN;
%MEND;

/* SINGLE CALL WITH ALL FIELDS */
%CONSOLIDATE_DISTINCT(
   TABLE=BUSINESS_TABLE, 
   FIELDS=FIELD1 FIELD2 FIELD3 STATUS REGION
);
/* Single call with all fields */
%consolidate_distinct(
   table=business_table, 
   fields=field1 field2 field3 status region
);





















%MACRO CONSOLIDATE_DISTINCT(TABLE=, FIELDS=);
   %LOCAL I FIELD;
   
   /* CREATE ONE LONG DATASET WITH ALL DISTINCT VALUES */
   PROC SQL;
      CREATE TABLE ALL_DISTINCT AS
      %DO I=1 %TO %SYSFUNC(COUNTW(&FIELDS));
         %LET FIELD = %SCAN(&FIELDS, &I);
         %IF &I > 1 %THEN UNION ALL;
         SELECT DISTINCT "&FIELD" AS FIELD_NAME, &FIELD AS VALUE
         FROM &TABLE
         WHERE &FIELD IS NOT MISSING
      %END;
      ;
   QUIT;
   
   /* ADD ROW NUMBERS WITHIN EACH FIELD */
   DATA ALL_DISTINCT;
      SET ALL_DISTINCT;
      BY FIELD_NAME;
      IF FIRST.FIELD_NAME THEN ROW_NUM = 1;
      ELSE ROW_NUM + 1;
   RUN;
   
   /* TRANSPOSE TO WIDE FORMAT */
   PROC TRANSPOSE DATA=ALL_DISTINCT OUT=CONSOLIDATED_DISTINCT(DROP=_NAME_);
      BY ROW_NUM;
      ID FIELD_NAME;
      VAR VALUE;
   RUN;
   
   PROC PRINT DATA=CONSOLIDATED_DISTINCT;
      TITLE "CONSOLIDATED DISTINCT VALUES";
   RUN;
%MEND;

%CONSOLIDATE_DISTINCT(
   TABLE=BUSINESS_TABLE, 
   FIELDS=FIELD1 FIELD2 FIELD3 STATUS REGION
);















%MACRO CONSOLIDATE_DISTINCT(TABLE=, FIELDS=);
   %LOCAL I FIELD;
   
   /* CREATE ONE LONG DATASET WITH ALL DISTINCT VALUES */
   PROC SQL;
      CREATE TABLE ALL_DISTINCT AS
      %DO I=1 %TO %SYSFUNC(COUNTW(&FIELDS));
         %LET FIELD = %SCAN(&FIELDS, &I);
         %IF &I > 1 %THEN UNION ALL;
         SELECT DISTINCT "&FIELD" AS FIELD_NAME, 
                CATS(&FIELD) AS VALUE
         FROM &TABLE
         WHERE &FIELD IS NOT MISSING
      %END;
      ;
   QUIT;
   
   /* ADD ROW NUMBERS WITHIN EACH FIELD */
   DATA ALL_DISTINCT;
      SET ALL_DISTINCT;
      BY FIELD_NAME;
      IF FIRST.FIELD_NAME THEN ROW_NUM = 1;
      ELSE ROW_NUM + 1;
   RUN;
   
   /* SORT BY ROW_NUM BEFORE TRANSPOSING */
   PROC SORT DATA=ALL_DISTINCT;
      BY ROW_NUM FIELD_NAME;
   RUN;
   
   /* TRANSPOSE TO WIDE FORMAT */
   PROC TRANSPOSE DATA=ALL_DISTINCT OUT=CONSOLIDATED_DISTINCT(DROP=_NAME_);
      BY ROW_NUM;
      ID FIELD_NAME;
      VAR VALUE;
   RUN;
   
   PROC PRINT DATA=CONSOLIDATED_DISTINCT;
      TITLE "CONSOLIDATED DISTINCT VALUES";
   RUN;
%MEND;

%CONSOLIDATE_DISTINCT(
   TABLE=BUSINESS_TABLE, 
   FIELDS=FIELD1 FIELD2 FIELD3 STATUS REGION
);
